# Automated Vulnerability Export and Import: Tenable → NinjaOne

This repository supports a fully automated workflow for **retrieving vulnerability data from Tenable via API**, formatting it for NinjaOne, and **importing it into NinjaOne automatically** using the NinjaOne API.

The process allows you to maintain up-to-date vulnerability data inside NinjaOne without manual exports or uploads.

---

## 🎥 Overview

This README accompanies a walkthrough video by **Jeff Hunter**, Field CTO at **NinjaOne**, demonstrating how to:

1. **Retrieve vulnerabilities from Tenable** using its REST API.  
2. **Store and format** the results into a NinjaOne-compatible CSV.  
3. **Import vulnerabilities into NinjaOne** via API for a fully automated process.

---

## 🧠 Prerequisites

Before starting, make sure you have:

1. **API Server Set Up**  
   This process relies on the [NinjaOne API Server / Automated Documentation Framework](https://docs.mspp.io/ninjaone-auto-documentation/getting-started) created by **Luke Whitelock**.  
   - 📖 [Setup Guide](https://docs.mspp.io/ninjaone-auto-documentation/getting-started)  
   - 🎥 [Video Walkthrough](https://www.youtube.com/watch?v=Qy9g6-KVfbo)

2. **NinjaOne Custom Fields**  
   You will need **two custom fields** to securely store your Tenable API credentials:
   - `Tenable Access Key`
   - `Tenable Secret Key`  
   Configure these as:
   - **Read-only from Automations**
   - **Editable for Technicians** (optional — for initial setup)

3. **Tenable Cloud API Access**  
   Most users will connect to: **https://cloud.tenable.com**

4. **Local Export Folder**  
Create a folder for exported data (example): **C:\TenableExport**

---

## Repository Scripts

- **Script 1 (this repository)**: Retrieves Tenable vulnerabilities via API and writes a CSV that matches NinjaOne’s format requirements.
- **Script 2 (NinjaOne Dojo article)**: Ingests the CSV produced by Script 1 into NinjaOne via API.  
Link: https://ninjarmm.zendesk.com/hc/en-us/articles/35563969789581-NinjaOne-Vulnerability-Management-Automating-the-Vulnerability-Import-Process

> The retrieval/formatting (Script 1) is vendor-specific; if you adapt for a different scanner, adjust the mapping to NinjaOne’s CSV format.

---

## Setup Steps

### 1) Import Script 1 (Retrieve + Format)
Add the script from this repository into NinjaOne.  
Configure:
- Tenable base URL (e.g., `https://cloud.tenable.com`)
- Output folder path (e.g., `C:\TenableExport`)
- CSV file name (e.g., `Vols_CVE_Exploded.csv`)

### 2) Create Custom Fields & Role Tab
- Go to **Administration → Device Custom Fields** and create:
- `Tenable Client`
- `Tenable Secret`
- Add these fields to the device representing your API server role:
- **Roles → (Your API Server Role)** → add a tab such as **“API Creds”**
- Include NinjaOne credentials (as needed) and the Tenable fields above
- Populate the Tenable keys on the API Server device record.

### 3) Initial Manual Import (One-Time)
Before automating imports, do a one-time import to establish a **Scan Group ID** in NinjaOne:
1. **Administration → Apps Exchange → Vulnerability Importer**
2. **Add Import** → Upload your Tenable CSV
3. **Matching Identifier**  
Map Tenable’s `asset.host_name` to NinjaOne’s **Host Name**  
> If you can export a unique identifier (e.g., serial/IP), prefer that to avoid hostname collisions.
4. **CVE Column**  
Select the column containing the **CVE ID**.

> **Note on data volume:** Tenable exports include both CVE-based and configuration findings. NinjaOne only processes rows **with a valid CVE ID**, so the imported total may be lower than Tenable’s raw CSV row count.

### 4) Get the Scan Group ID
- Go to **API → API Documentation** in NinjaOne
- Search **“Vulnerability Management”**
- Run **“Fetch all scan groups”**
- Note the numeric **ID** for your import (e.g., `8`)

### 5) Import ingest script
Import and configure the importer script from the Dojo article. You'll need to input the scan group ID, and confirm that the CSV folder path and CSV file name are setup correctly, as is your NinjaOne instance. 

### 6) Schedule retrieve script (Retrieve Vulnerability from Tenable)
In your **API Server Policy → Scheduled Automations**:
- Schedule `Retrieve Vulnerabilities from Tenable` **after** your Tenable scans complete (e.g., daily at 9:00 AM).

### 7) Schedule ingest script from the Dojo

---

## CSV Requirements (NinjaOne)

NinjaOne expects the following:

- Each **unique CVE ID** must appear on **its own row**.  
- Any row **without a CVE ID** will be **rejected**.

**Example schema:**

| Device Name | CVE ID        | Severity | Description                         | Vendor  | Detected Date |
|--------------|---------------|----------|-------------------------------------|---------|----------------|
| WIN-01       | CVE-2025-1234 | High     | Windows kernel privilege escalation | Tenable | 2025-10-28     |
| WIN-01       | CVE-2025-4321 | Medium   | SMB information disclosure          | Tenable | 2025-10-28     |

> Ensure your Script 1 output **expands multiple CVEs per asset** into separate rows.

---



