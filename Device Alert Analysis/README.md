This script retrieves **activities** from the NinjaOne Public API for a specified time window, filters to **CONDITION** activities with `statusCode = TRIGGERED`, and then calculates **per-device alert metrics** such as:

- Total number of condition triggers per device
- Top 10 most frequently triggered conditions per device (rendered as an HTML table)
- Device rank by trigger volume (relative to other alerting devices)
- A Day-of-Month × Month heatmap of triggers (rendered as HTML)
- The total number of devices in the environment that have a condition that has triggered over the past 30 days

The script can optionally **write these results back to each device as custom fields** using:
`PATCH /api/v2/device/{deviceId}/custom-fields`.

## Required Custom Fields (for write-back)

Create the following **Device-scope** custom fields with the listed permissions.  
You may rename these fields, but if you do, you must update the keys in `New-CustomFieldPayloadFromReport` accordingly.

| **API Name (Key)**            | **Display Name**              | **Permissions**                                                                 | **Scope** | **Type**   |
|------------------------------|-------------------------------|----------------------------------------------------------------------------------|----------:|-----------|
| `totalConditionsTriggered`   | Total Conditions Triggered     | - Read-Only to Technicians<br>- Read-Only to Automations<br>- Read/Write to API | Device    | Integer    |
| `deviceAlertRank`            | Device Alert Rank              | - Read-Only to Technicians<br>- Read-Only to Automations<br>- Read/Write to API | Device    | Integer    |
| `totalAlertingDevices`       | Total Alerting Devices         | - Read-Only to Technicians<br>- Read-Only to Automations<br>- Read/Write to API | Device    | Integer    |
| `mostFrequentAlerts`         | Most Frequent Alerts (Top 10)  | - Read-Only to Technicians<br>- Read-Only to Automations<br>- Read/Write to API | Device    | WYSIWYG   |
| `alertHeatMap`               | Alert Heatmap                  | - Read-Only to Technicians<br>- Read-Only to Automations<br>- Read/Write to API | Device    | WYSIWYG   |

### Notes
- The two WYSIWYG fields store **HTML** generated by the script:
  - `mostFrequentAlerts`: HTML table of the device’s top 10 triggered conditions
  - `alertHeatMap`: HTML heatmap table (Day 1–31 × Month)
- The script warns if HTML output approaches NinjaOne WYSIWYG size limits (the helper checks ~200,000 characters).
